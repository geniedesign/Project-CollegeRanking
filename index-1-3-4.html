<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>中国大学排行榜</title>
  <link rel = "stylesheet" href = "css/themecss.css">
  <!--pure css-->
  <link rel="stylesheet" href="css/pure.css">
  <link rel="stylesheet" href="css/blog.css">
  <link rel="stylesheet" href="css/grids-responsive-min.css">
  <!--[if lte IE 8]>
    <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--pure css-->
    <script type="text/javascript" src="./exampleData/treemap.d3.js"></script>
    <script type="text/javascript" src="./exampleData/treemap.d3.layout.js"></script>
  <script src="./js/d3.v3.min.js"></script>
</head>

<body>
<!--
=============prepare===============
-->
<script>
var test;
if((document.all ? 'IE' : 'others') == 'IE'){
    alert('很抱歉，我们暂不支持IE浏览器，请使用其他浏览器');
    document.execCommand("Stop")
}
function getSize(){
    var pageWidth = window.innerWidth;
    var pageHeight = window.innerHeight; 
    if(typeof(pageWidth) != "number"){ 
        if(document.compatMode == "number"){ 
        pageWidth = document.documentElement.clientWidth; 
        pageHeight = document.documentElement.clientHeight; 
        }else{ 
        pageWidth = document.body.clientWidth; 
        pageHeight = document.body.clientHeight; 
        } 
    }
    var p = {
      'height': pageHeight,
      'width': pageWidth
    }
    return p;
}

var winSize = getSize();
</script>

  <div id="layout">

      <div class="sidebar pure-u-1 pure-u-md-1-4">
          <div class="header">
              <h1 class="brand-title">College Ranking</h1>
              <p class="brand-tagline">Build a personalized University Rankings. </p>
          </div>
          <div class="nav">
            <div class="weight param">
                <p>选择参数</p>
            </div>

            <div class="type param">
                <p>选择学校类型</p>
                <form class="pure-form pure-form-stacked">
                    <fieldset>
                      <input id = "type-all" type = "checkbox" checked = "true" hidden onclick = "type_all(this.checked)"/>
                      <label for = "type-all" class = "type-all">全选</label>
                    </fieldset>
                </form>
            </div>
          </div>
      </div>

      <div class="content pure-u-1 pure-u-md-3-4">
              <!-- A wrapper for all the blog posts -->
              <div class="posts">
                  <h1 class="content-subhead">RANK POST</h1>
              </div>
      </div>

  </div>

<!--
=============draw main rank=============
-->
    <script>
        var margin = {top: 20, right: 20, bottom: 30, left: 40},
              width = 960 - margin.left - margin.right,
              height = 3000 - margin.top - margin.bottom;

        var x = d3.scale.linear()
            .rangeRound([0, width]);

        var y = d3.scale.ordinal()
            .rangeRoundBands([0, height], .1);

        var color = d3.scale.ordinal()
                         .range(["#557381","#cc7f9d","#aeafbf","#eec6ad","#746b7e","#76b0bb","#da8082","#bd96cb","#c5bcaf","#b5c1cf","#a1c5ad","#6e99a2","#3b525a","#9e9dba","#dd9d9c"]);

        var xAxis = d3.svg.axis()
            .scale(x)
            .orient("top")
            .tickFormat(d3.format(".2s"));//?

        var yAxis = d3.svg.axis()
            .scale(y)
            .orient("left");

        var svg = d3.select("body").select(".content").select(".posts").append("svg")
            .attr("width", winSize.width*0.6)
            .attr("height", winSize.height)
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        d3.csv("data/all.csv", function(error, data) {
          color.domain(d3.keys(data[0]).filter(function(key) { return (key !== "name")&&(key !== "type")&&(key !== "province"); }));

          data.forEach(function(d) {
            var x0 = 0;
            d.param = color.domain().map(function(paramName) { return {paramName: paramName, x0: x0, x1: x0 += +d[paramName]}; });
            d.score = d.param[d.param.length - 1].x1;//total points
          });

          data.sort(function(a, b) { return b.score - a.score; });

          x.domain([0, d3.max(data, function(d) { return d.score; })]);//bar length
          y.domain(data.map(function(d) { return d.name; }));//university's name

          svg.append("g")
              .attr("class", "x axis")
              //.attr("transform", "translate(0," + height + ")")
              .call(xAxis);

          svg.append("g")
              .attr("class", "y axis")
              .call(yAxis)
              .append("text")
              .attr("transform", "rotate(-90)")
              .attr("y", 6)
              .attr("width",20)
              .attr("dy", ".71em")
              .style("text-anchor", "end");

          var university = svg.selectAll(".university")
              .data(data)
              .enter().append("g")
              .attr("class", "university")
              .attr("transform", function(d) { return "translate(0," + y(d.name) + ")"; });

          university.selectAll("rect")
              .data(function(d) { return d.param; })
            .enter().append("rect")
              .attr("height", /*y.rangeBand()*/20)
              .attr("x", function(d) { return x(d.x0); })
              .attr("width", function(d) { return x(d.x1) - x(d.x0); })
              .style("fill", function(d) { return color(d.paramName); });
        })
    </script>

<!--
=============draggable treemap=============
-->
     <script>
          var treemapWidth = 300,
                treemapHeight = 300;

          var treemap = d3.layout.treemap()
              .round(false)
              .size([treemapWidth, treemapHeight])
              .sticky(true)
              .value(function(d) { return d.size; });

          var treemapSvg = d3.select("body").select(".sidebar").select(".nav").select(".weight").append("div")
              .attr("class", "selectBoard")
              .style("position", "relative")
              .style("width", treemapWidth + "px")
              .style("height", treemapHeight + "px")
              .append("svg:svg")
              .attr("width", treemapWidth)
              .attr("height", treemapHeight)
              .append("svg:g")
              .attr("transform", "translate(.5,.5)");

          d3.json("data/flare.json", function(error, root) {

              var nodes = treemap.nodes(root)
                  .filter(function(d) {
                   return !d.children; });

              var cell = treemapSvg.selectAll("g")
                  .data(nodes)
                  .enter().append("svg:g")
                  .attr("class", "cell")
                  .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; })
                  .on("click", function(d) {console.log("click");});

              cell.append("svg:rect")
                  .attr("width", function(d) { return d.dx - 1; })
                  .attr("height", function(d) { return d.dy - 1; })
                  .style("fill", function(d) { return color(d.parent.name); });

              cell.append("svg:text")
                  .attr("x", function(d) { return d.dx / 2; })
                  .attr("y", function(d) { return d.dy / 2; })
                  .attr("dy", ".35em")
                  .attr("text-anchor", "middle")
                  .text(function(d) { return d.name; });
          });

          function position() {
            this.style("left", function(d) { return d.x + "px"; })
                .style("top", function(d) { return d.y + "px"; })
                .style("width", function(d) { return Math.max(0, d.dx - 1) + "px"; })
                .style("height", function(d) { return Math.max(0, d.dy - 1) + "px"; });
          }
     </script>

</body>
</html>