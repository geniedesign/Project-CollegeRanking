<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>中国大学排行榜</title>
  <link href = "css/themecss.css" rel = "stylesheet"/>
  <script src="./js/d3.v3.min.js"></script>
</head>

<body>

<!--
=============prepare===============
-->
    <script>
    var test;
    if((document.all ? 'IE' : 'others') == 'IE'){
        alert('很抱歉，我们暂不支持IE浏览器，请使用其他浏览器');
        document.execCommand("Stop")
    }
    function getSize(){
        var pageWidth = window.innerWidth;
        var pageHeight = window.innerHeight; 
        if(typeof(pageWidth) != "number"){ 
            if(document.compatMode == "number"){ 
            pageWidth = document.documentElement.clientWidth; 
            pageHeight = document.documentElement.clientHeight; 
            }else{ 
            pageWidth = document.body.clientWidth; 
            pageHeight = document.body.clientHeight; 
            } 
        }
        var p = {
          'height': pageHeight,
          'width': pageWidth
        }
        return p;
    }
    </script>

<!--
=============draw main rank=============
-->
    <script>

        var winSize = getSize();

        var margin = {top: 20, right: 20, bottom: 30, left: 100},
            width = 960 - margin.left - margin.right,
            height = 1600 - margin.top - margin.bottom;

        var x = d3.scale.linear()
            .rangeRound([0, width]);

        var y = d3.scale.ordinal()
            .rangeRoundBands([0, height], .1);

        var color = d3.scale.category20();

        var xAxis = d3.svg.axis()
            .scale(x)
            .orient("top")
            .tickFormat(d3.format(".2s"));//?

        var yAxis = d3.svg.axis()
            .scale(y)
            .orient("left");

        var svg = d3.select("body").append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", winSize.height - margin.top - margin.bottom)
          .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        d3.csv("data/all.csv", function(error, data) {
          color.domain(d3.keys(data[0]).filter(function(key) { return (key !== "name")&&(key !== "type")&&(key !== "province"); }));

          data.forEach(function(d) {
            var x0 = 0;
            d.param = color.domain().map(function(paramName) { return {paramName: paramName, x0: x0, x1: x0 += +d[paramName]}; });
            d.score = d.param[d.param.length - 1].x1;//total points
          });

          data.sort(function(a, b) { return b.score - a.score; });

          x.domain([0, d3.max(data, function(d) { return d.score; })]);//bar length
          y.domain(data.map(function(d) { return d.name; }));//schools' name

          svg.append("g")
              .attr("class", "x axis")
              //.attr("transform", "translate(0," + height + ")")
              .call(xAxis);

          svg.append("g")
              .attr("class", "y axis")
              .call(yAxis)
              .append("text")
              .attr("transform", "rotate(-90)")
              .attr("y", 6)
              .attr("width",20)
              .attr("dy", ".71em")
              .style("text-anchor", "end");

          var state = svg.selectAll(".state")
              .data(data)
            .enter().append("g")
              .attr("class", "g")
              .attr("transform", function(d) { return "translate(0," + y(d.name) + ")"; });

          state.selectAll("rect")
              .data(function(d) { return d.param; })
            .enter().append("rect")
              .attr("height", y.rangeBand())
              .attr("x", function(d) { return x(d.x0); })
              .attr("width", function(d) { return x(d.x1) - x(d.x0); })
              .style("fill", function(d) { return color(d.paramName); });
        })
    </script>

<!--
=============draggable treemap=============
-->
     <script>

     </script>

</body>
</html>